<!DOCTYPE html>
<html lang="en" class="bg-gray-50">
<head>
    <meta charset="UTF-8">
    <title>Your Complete Travel Plan</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom pseudo-elements for the timeline line */
        .timeline-item:not(:last-child)::before {
            content: '';
            position: absolute;
            left: 1rem; /* Center on the dot */
            top: 2rem; /* Start below the dot */
            bottom: -1.5rem; /* Extend to the next item's top */
            width: 2px;
            background-color: #e5e7eb; /* gray-200 */
            transform: translateX(-50%);
        }
    </style>
</head>
<body class="bg-gray-100 font-sans">
    <header class="h-96 bg-cover bg-center" style="background-image: linear-gradient(rgba(0,0,0,0.55), rgba(0,0,0,0.2)), url('{{ background_image_url }}');">
        <div class="flex flex-col items-center justify-center h-full text-white text-center p-4">
            <h1 class="text-4xl md:text-6xl font-extrabold tracking-tight">{{ plan.title }}</h1>
            <p class="mt-4 max-w-3xl text-lg md:text-xl text-gray-200 p-10">{{ plan.why_this_destination }}</p>
        </div>
    </header>

    <main class="max-w-4xl mx-auto p-4 md:p-8 -mt-24">
        <div class="bg-white rounded-lg shadow-2xl p-6 md:p-10 space-y-16">
            
            <!-- Section: Trip Overview -->
            <section>
                <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">Trip Overview</h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="bg-gray-50 p-6 rounded-lg">
                        <div class="flex items-center mb-2">
                            <svg class="w-6 h-6 text-green-500 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v.01"></path></svg>
                            <h3 class="text-lg font-semibold text-gray-700">Budget</h3>
                        </div>
                        <p class="text-gray-600">{{ plan.assumptions.budget_per_person }}</p>
                    </div>
                    <div class="bg-gray-50 p-6 rounded-lg">
                        <div class="flex items-center mb-2">
                            <svg class="w-6 h-6 text-blue-500 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path></svg>
                            <h3 class="text-lg font-semibold text-gray-700">Origin</h3>
                        </div>
                        <p class="text-gray-600">{{ plan.assumptions.origin }}</p>
                    </div>
                    <div class="bg-gray-50 p-6 rounded-lg">
                        <div class="flex items-center mb-2">
                             <svg class="w-6 h-6 text-purple-500 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg>
                            <h3 class="text-lg font-semibold text-gray-700">Visa</h3>
                        </div>
                        <p class="text-gray-600">{{ plan.assumptions.visa_status }}</p>
                    </div>
                </div>
                <div class="mt-8">
                    <h3 class="text-xl font-semibold text-gray-700 mb-4">Estimated Budget Breakdown (Per Person)</h3>
                    <ul class="space-y-3 text-gray-700 bg-gray-50 p-6 rounded-lg">
                        <li class="flex justify-between border-b pb-2"><span>‚úàÔ∏è Flights:</span> <strong class="font-mono">{{ plan.budget_breakdown.flights }}</strong></li>
                        <li class="flex justify-between border-b pb-2"><span>üõÇ Visa & Fees:</span> <strong class="font-mono">{{ plan.budget_breakdown.visa_fees }}</strong></li>
                        <li class="flex justify-between border-b pb-2"><span>üè® Accommodation:</span> <strong class="font-mono">{{ plan.budget_breakdown.accommodation }}</strong></li>
                        <li class="flex justify-between border-b pb-2"><span>üçú Activities & Food:</span> <strong class="font-mono">{{ plan.budget_breakdown.activities_and_food }}</strong></li>
                        <li class="flex justify-between"><span>üí∞ Contingency:</span> <strong class="font-mono">{{ plan.budget_breakdown.contingency }}</strong></li>
                    </ul>
                </div>
            </section>
            
            <!-- Section: Detailed Itinerary (UPDATED) -->
            <section>
                <h2 class="text-3xl font-bold text-gray-800 mb-8 text-center">Your Detailed Itinerary</h2>
                <div class="relative">
                    {% for day, activities in plan.detailed_itinerary.items() %}
                    <div class="timeline-item relative pl-10 pb-12">
                        <div class="absolute left-0 top-0 h-4 w-4 bg-blue-500 rounded-full mt-1"></div>
                        <div class="bg-gray-50 rounded-lg p-6">
                            
                            <!-- Check if activities is an object (like Day 1) or a string (like Day 0) -->
                            {% if activities is mapping %}
                                <h3 class="text-xl font-bold text-blue-800">{{ day }}{% if activities.theme %} - <span class="text-lg font-medium text-gray-600">{{ activities.theme }}</span>{% endif %}</h3>
                                <div class="mt-4 text-gray-700 space-y-3">
                                    <!-- 
                                    THIS IS THE CRITICAL CHANGE:
                                    We now access .activity to get the text
                                    -->
                                    <p><strong>Morning:</strong> {{ activities.morning.activity }}</p>
                                    <p><strong>Afternoon:</strong> {{ activities.afternoon.activity }}</p>
                                    <p><strong>Evening:</strong> {{ activities.evening.activity }}</p>
                                </div>
                            {% else %}
                                <!-- This handles Day 0, which is just a string -->
                                <h3 class="text-xl font-bold text-blue-800">{{ day }}</h3>
                                <p class="mt-2 text-gray-700">{{ activities }}</p>
                            {% endif %}

                        </div>
                    </div>
                    {% endfor %}
                </div>
            </section>
            
            <!-- Section: Pro-Tips & Prep -->
            <section class="border-t-2 border-gray-100 pt-12">
                <h2 class="text-3xl font-bold text-gray-800 mb-8 text-center">Pro-Tips & Prep</h2>
                <h3 class="text-xl font-semibold text-gray-700 mb-4">Booking Tips</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                    <div class="bg-blue-50 p-5 rounded-lg">
                        <h4 class="font-bold text-blue-800">‚úàÔ∏è Flights</h4>
                        <p class="text-gray-700 mt-2 text-sm">{{ plan.booking_tips.flights }}</p>
                    </div>
                    <div class="bg-blue-50 p-5 rounded-lg">
                        <h4 class="font-bold text-blue-800">üè® Accommodation</h4>
                        <p class="text-gray-700 mt-2 text-sm">{{ plan.booking_tips.accommodation }}</p>
                    </div>
                    <div class="bg-blue-50 p-5 rounded-lg">
                        <h4 class="font-bold text-blue-800">üöÜ Trains/Local</h4>
                        <p class="text-gray-700 mt-2 text-sm">{{ plan.booking_tips.trains }}</p>
                    </div>
                </div>
                <h3 class="text-xl font-semibold text-gray-700 mb-4">Visa & Insurance</h3>
                <div class="bg-gray-50 p-5 rounded-lg mb-8">
                    <p class="text-gray-700">{{ plan.visa_and_insurance }}</p>
                </div>
                <h3 class="text-xl font-semibold text-gray-700 mb-4">Pre-Trip Checklist</h3>
                <div class="bg-gray-50 p-5 rounded-lg">
                    <ul class="space-y-2">
                        {% for item in plan.checklist %}
                        <li class="flex items-center text-gray-700">
                            <svg class="w-5 h-5 text-green-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                            {{ item }}
                        </li>
                        {% endfor %}
                    </ul>
                </div>
            </section>
            
            <!-- Section: Revise Plan -->
            <section class="mt-8 border-t-2 border-gray-100 pt-12">
                <h2 class="text-3xl font-bold text-gray-800 mb-3 text-center">Want to Make Changes?</h2>
                <p class="text-gray-600 mb-6 text-center max-w-2xl mx-auto">Is there anything you'd like to adjust? Be specific! For example, "Can you add a museum on Day 4?" or "Swap the hike for a relaxing spa day."</p>
                <form action="/revise" method="post" class="max-w-xl mx-auto">
                    <textarea name="original_plan" class="hidden">{{ plan | tojson }}</textarea>
                    <textarea name="revision_request" rows="4" class="w-full p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Tell us what to change..." required></textarea>
                    <button type="submit" class="w-full mt-4 px-4 py-3 font-semibold text-white bg-green-600 rounded-lg hover:bg-green-700">
                        ‚ú® Generate Revised Plan
                    </button>
                </form>
            </section>

            <!-- 
            --- NEW NAVIGATION SECTION ---
            This adds the new button you wanted, plus the existing "Plan a New Trip" button.
            -->
            <section class="mt-12 text-center border-t-2 border-gray-100 pt-10">
                <div class="flex flex-col sm:flex-row justify-center gap-4 max-w-xl mx-auto">
                    <!-- Button 1: Plan New Trip -->
                    <a href="/" class="w-full sm:w-auto px-8 py-3 font-semibold text-white bg-blue-600 rounded-lg hover:bg-blue-700">
                        ‚Üê Plan a New Trip
                    </a>

                    <!-- Button 2: Go to Booking Hub (NEW) -->
                    <form action="/bookings" method="post" class="w-full sm:w-auto">
                        <!-- This hidden field sends the plan data to the /bookings route -->
                        <textarea name="original_plan" class="hidden">{{ plan | tojson }}</textarea>
                        <button type="submit" class="w-full px-8 py-3 font-semibold text-white bg-indigo-600 rounded-lg hover:bg-indigo-700">
                            Go to Booking Hub üìÖ
                        </button>
                    </form>
                </div>
            </section>
            <!-- --- END OF NEW SECTION --- -->

        </div>
    </main>
</body>
</html>

